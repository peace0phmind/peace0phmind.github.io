---
title: "情绪识别方案"
description: "face-inspection-program"
keywords: "face,inspection,program"

date: 2022-11-18T16:15:38+08:00
lastmod: 2022-11-18T16:15:38+08:00

author: peace0phmind
url: "posts/202211/face-inspection-program"

draft: true

categories:
  -
tags:
  -

---

# 情绪识别方案概述

## 系统部署与初始化

在客服试点房间安装A200挂轨机器人，在客户机房安装大华AI服务器，并部署客服质检系统。

安装部署挂轨机器人时，需按照巡检工位位置配置巡检点信息。并配置日常巡检频次、方式等信息。

完成大华AI服务器与客服质检系统部署后，需要将客服资料（包括：姓名、年龄、工号、头像）信息录入到客服质检系统中，由客服客服质检系统完成头像（人脸）到大华AI服务器的注册。
    
完成上述步骤后，则完成了系统的部署与初始化。


下图为客服质检系统到大华AI服务器的注册时序图：
![](/images/202211/face-inspection-program/1.jpg)

## 日常巡检(质检)

机器人巡检任务触发后，会自动按照巡检路线沿着巡检点逐个巡检。

当A200挂轨机器人移动到其中一个巡检点后，会按照系统初始化的相关信息调整摄像头角度，焦距等参数，并进行拍照，并将照片保留在A200挂轨机器人上。
同时根据系统初始化的相关信息调整红外探测传感器角度，抓取当前工位上员工体温。完成上述两个动作后，A200挂轨机器人移动到下一个质检点继续上述动作。

在移动到下个质检点的同时，A200挂轨机器人会向客服质检系统推送质检点信息，温度和巡检点抓拍的照片。客服质检系统使用A200挂轨机器人传递过来的图片向大华AI服务器发起人脸检测请求。
大华AI服务器接收到人脸图片，对图片进行处理，识别出图片中的人是谁（与注册流程对应的一个ID），并且返回对应的情绪信息。
客服之间系统接收到人脸情绪识别结果后，将结果记录在客服质检系统中，该系统提供质检历史记录以及告警功能。


下图为质检动作的系统间接口调用时序图：
![](/images/202211/face-inspection-program/2.jpg)

# 情绪识别算法概述

## 人脸识别算法

[参见: https://medium.com/@ageitgey/machine-learning-is-fun-part-4-modern-face-recognition-with-deep-learning-c3cffc121d78](https://github.com/ageitgey/face_recognition)

### 找到图片中的人脸

采用定向梯度直方图——或简称为HOG的方法在图片中查找人脸。

HOG的大致步骤为：

1. 将图片转换为黑白色
2. 遍历的查找每一个像素以及直接围绕它的像素进行明暗比较，并画一个箭头显示图像变暗的方向
3. 将图像分解为每个16X16像素的小方块。在每个正方形中，计算每个主要方向上的梯度点组成向量
4. 最终用一套简单的算法，将人脸从HOG图中分离出来

### 分析人脸特征

采用Face Landmark Detection算法进行人脸特征识别。

大致步骤为：

1. 提出存在于每张脸上的68个特定点（称为landmarks），比如下巴顶部、每只眼睛的外缘、每条眉毛的内缘等。
2. 使用简单地旋转、缩放和剪切图像，使眼睛和嘴巴尽可能居中

### 使用特征进行人脸编码

编码器使用深度卷积神经网络进行编码，具体步骤如下：

1. 算法模型为一个14层的卷积神经网络，输入为上步骤处理后的人脸头像，输出为一个128维的vector
2. 加载三张人脸图像：一个已知人的训练面部图像，同一个人的另一张面部图像，一个完全不同的人的面部图像
3. 通过Adam优化器，让图像1和2的Loss最小，图像2和3的Loss最大
4. 使用上述网络训练出来的人脸编码器对人脸进行编码

### 给出预测

建立一个线性SVM分类器的人脸库，将人脸编码和一个唯一ID值绑定在一起。该SVM分类器的输入是人脸编码，结果是这个人脸对应的ID。


## 情绪识别算法

### 前置处理

情绪识别的前置处理参见人脸识别的步骤1和2

### 模型构造与训练

1. 算法模型为一个17层的神经网络，输入为人脸识别步骤2输出的人脸头像，输出为通过softmax的Logistic Classification网络
2. 将收集到的人脸与情绪标签的数据作为输入，使用Adam优化其进行优化，进行模型训练，得到情绪识别模型。

### 给出预测

系统调用上述情绪识别模型，给出情绪识别结果。

# 情绪识别技术指标

## 人脸识别指标

在[Labeled Faces in the Wild](http://vis-www.cs.umass.edu/lfw/)上的准确率为99.38%

## 情绪识别指标

在私有情绪表情库上，识别准确率95%